package com.wsingnal.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

import com.wsingnal.dto.UserDto;
import com.wsingnal.service.SmsService;
import com.wsingnal.service.UserService;

@RestController
public class WSignalController {

	@Autowired
	private UserService userService;

	@Autowired
	private SmsService smsService;

	@PostMapping("/api/signup")
	public ResponseEntity<String> signUp(@RequestBody UserDto UserDTO) {

		boolean success = userService.registerUser(UserDTO);
		if (success) {
			return ResponseEntity.ok("회원가입 성공!");
		} else {
			return ResponseEntity.status(HttpStatus.BAD_REQUEST).body("이미 사용 중인 이메일입니다.");
		}
	}

	// 인증번호 전송 API
	@PostMapping("/send-sms")
	public ResponseEntity<?> sendVerificationCode(@RequestBody SmsRequest smsRequest) {
		String phoneNumber = smsRequest.getPhone();
		boolean success = smsService.sendVerificationCode(phoneNumber);

		if (success) {
			return ResponseEntity.ok().body("인증번호가 발송되었습니다.");
		} else {
			return ResponseEntity.status(500).body("인증번호 전송에 실패했습니다.");
		}
	}

	// 인증번호 검증 API
	@PostMapping("/verify-sms")
	public ResponseEntity<?> verifyCode(@RequestBody SmsRequest smsRequest) {
		String phoneNumber = smsRequest.getPhone();
		String code = smsRequest.getCode();

		boolean success = smsService.verifyCode(phoneNumber, code);

		if (success) {
			return ResponseEntity.ok().body("인증번호가 올바릅니다.");
		} else {
			return ResponseEntity.status(400).body("인증번호가 올바르지 않습니다.");
		}
	}

}
